<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><title>Python: module imageinfo</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
</head><body bgcolor="#f0f0f8">

<table width="100%" cellspacing=0 cellpadding=2 border=0 summary="heading">
<tr bgcolor="#7799ee">
<td valign=bottom>&nbsp;<br>
<font color="#ffffff" face="helvetica, arial">&nbsp;<br><big><big><strong>imageinfo</strong></big></big></font></td
><td align=right valign=bottom
><font color="#ffffff" face="helvetica, arial"><a href=".">index</a><br><a href="file:/home/thorvald/PycharmProjects/StamboomServer/imageinfo.py">/home/thorvald/PycharmProjects/StamboomServer/imageinfo.py</a></font></td></tr></table>
    <p><tt>#&nbsp;__author__&nbsp;=&nbsp;'markasread.com'<br>
#<br>
#&nbsp;import&nbsp;struct,&nbsp;io<br>
#<br>
#&nbsp;def&nbsp;get_image_info(data):<br>
#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"""<br>
#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Return&nbsp;(content_type,&nbsp;width,&nbsp;height)&nbsp;for&nbsp;a&nbsp;given&nbsp;img&nbsp;file&nbsp;content<br>
#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;no&nbsp;requirements<br>
#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"""<br>
#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;data&nbsp;=&nbsp;str(data)<br>
#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;size&nbsp;=&nbsp;len(data)<br>
#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;height&nbsp;=&nbsp;-1<br>
#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;width&nbsp;=&nbsp;-1<br>
#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;content_type&nbsp;=&nbsp;''<br>
#<br>
#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;handle&nbsp;GIFs<br>
#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(size&nbsp;&gt;=&nbsp;10)&nbsp;and&nbsp;data[:6]&nbsp;in&nbsp;('GIF87a',&nbsp;'GIF89a'):<br>
#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Check&nbsp;to&nbsp;see&nbsp;if&nbsp;content_type&nbsp;is&nbsp;correct<br>
#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;content_type&nbsp;=&nbsp;'image/gif'<br>
#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;w,&nbsp;h&nbsp;=&nbsp;struct.unpack("&lt;HH",&nbsp;data[6:10])<br>
#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;width&nbsp;=&nbsp;int(w)<br>
#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;height&nbsp;=&nbsp;int(h)<br>
#<br>
#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;See&nbsp;PNG&nbsp;2.&nbsp;Edition&nbsp;spec&nbsp;(<a href="http://www.w3.org/TR/PNG/">http://www.w3.org/TR/PNG/</a>)<br>
#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Bytes&nbsp;0-7&nbsp;are&nbsp;below,&nbsp;4-byte&nbsp;chunk&nbsp;length,&nbsp;then&nbsp;'IHDR'<br>
#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;and&nbsp;finally&nbsp;the&nbsp;4-byte&nbsp;width,&nbsp;height<br>
#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;elif&nbsp;((size&nbsp;&gt;=&nbsp;24)&nbsp;and&nbsp;data.startswith('\211PNG\r\n\032\n')<br>
#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;and&nbsp;(data[12:16]&nbsp;==&nbsp;'IHDR')):<br>
#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;content_type&nbsp;=&nbsp;'image/png'<br>
#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;w,&nbsp;h&nbsp;=&nbsp;struct.unpack("&gt;LL",&nbsp;data[16:24])<br>
#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;width&nbsp;=&nbsp;int(w)<br>
#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;height&nbsp;=&nbsp;int(h)<br>
#<br>
#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Maybe&nbsp;this&nbsp;is&nbsp;for&nbsp;an&nbsp;older&nbsp;PNG&nbsp;version.<br>
#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;elif&nbsp;(size&nbsp;&gt;=&nbsp;16)&nbsp;and&nbsp;data.startswith('\211PNG\r\n\032\n'):<br>
#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;Check&nbsp;to&nbsp;see&nbsp;if&nbsp;we&nbsp;have&nbsp;the&nbsp;right&nbsp;content&nbsp;type<br>
#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;content_type&nbsp;=&nbsp;'image/png'<br>
#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;w,&nbsp;h&nbsp;=&nbsp;struct.unpack("&gt;LL",&nbsp;data[8:16])<br>
#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;width&nbsp;=&nbsp;int(w)<br>
#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;height&nbsp;=&nbsp;int(h)<br>
#<br>
#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;handle&nbsp;JPEGs<br>
#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;elif&nbsp;(size&nbsp;&gt;=&nbsp;2)&nbsp;and&nbsp;data.startswith('\377\330'):<br>
#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;content_type&nbsp;=&nbsp;'image/jpeg'<br>
#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;jpeg&nbsp;=&nbsp;io.StringIO(data)<br>
#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;jpeg.read(2)<br>
#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;b&nbsp;=&nbsp;jpeg.read(1)<br>
#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;try:<br>
#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;while&nbsp;(b&nbsp;and&nbsp;ord(b)&nbsp;!=&nbsp;0xDA):<br>
#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;while&nbsp;(ord(b)&nbsp;!=&nbsp;0xFF):&nbsp;b&nbsp;=&nbsp;jpeg.read<br>
#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;while&nbsp;(ord(b)&nbsp;==&nbsp;0xFF):&nbsp;b&nbsp;=&nbsp;jpeg.read(1)<br>
#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(ord(b)&nbsp;&gt;=&nbsp;0xC0&nbsp;and&nbsp;ord(b)&nbsp;&lt;=&nbsp;0xC3):<br>
#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;jpeg.read(3)<br>
#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;h,&nbsp;w&nbsp;=&nbsp;struct.unpack("&gt;HH",&nbsp;jpeg.read(4))<br>
#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break<br>
#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else:<br>
#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;jpeg.read(int(struct.unpack("&gt;H",&nbsp;jpeg.read(2))[0])-2)<br>
#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;b&nbsp;=&nbsp;jpeg.read(1)<br>
#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;width&nbsp;=&nbsp;int(w)<br>
#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;height&nbsp;=&nbsp;int(h)<br>
#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;except&nbsp;struct.error:<br>
#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pass<br>
#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;except&nbsp;ValueError:<br>
#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pass<br>
#<br>
#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;content_type,&nbsp;width,&nbsp;height</tt></p>

</body></html>